<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}">
    <style>
        .aero-panel {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 120, 215, 0.2);
        }
        
        .aero-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            background: white;
            font-size: 16px;
        }
        
        .aero-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 20px;
        }
        
        .form-footer a {
            color: #1976D2;
            text-decoration: none;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffcdd2;
        }
        
        .calc-info {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            color: #2e7d32;
            text-align: center;
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group .reset-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #f5f5f5;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .result-display {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            color: #1976d2;
        }
        
        .nutrition-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        .calculated-input {
            background-color: #f0f8ff !important;
            border-color: #2196F3 !important;
        }
        
        .optional-field {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="aero-panel">
        <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ</h1>
        
        {% if error %}
        <div class="error-message">{{ error }}</div>
        {% endif %}
        
        <div class="calc-info">
            üí° –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥ –ø—Ä–æ–¥—É–∫—Ç–∞, –∑–∞—Ç–µ–º —É–∫–∞–∂–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≤–µ—Å
        </div>
        
        <form method="POST" id="meal-form">
            <select class="aero-input" name="meal_type" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–µ–º –ø–∏—â–∏</option>
                {% for meal_type in meal_types %}
                <option value="{{ meal_type }}" {% if meal.meal_type == meal_type %}selected{% endif %}>
                    {{ meal_type|capitalize }}
                </option>
                {% endfor %}
            </select>
            
            <input type="text" class="aero-input" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞" 
                   value="{{ meal.name }}" required>
            
            <div class="input-group">
                <input type="number" step="0.1" class="aero-input" id="grams" name="grams" 
                       placeholder="–í–µ—Å (–≥)" value="{{ meal.grams }}" required min="0.1">
                <button type="button" class="reset-btn" onclick="resetTo100g()">‚Ü∫</button>
            </div>
            
            <!-- –ü–æ–ª—è –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞ 100–≥ -->
            <span class="nutrition-label">–ù–∞ 100–≥ –ø—Ä–æ–¥—É–∫—Ç–∞ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å 0):</span>
            <input type="number" step="0.1" class="aero-input optional-field" id="calories-per-100g" 
                   name="calories_per_100g" placeholder="–ö–∞–ª–æ—Ä–∏–∏ –Ω–∞ 100–≥ (–∫–∫–∞–ª)" min="0">
            
            <input type="number" step="0.1" class="aero-input optional-field" id="proteins-per-100g" 
                   name="proteins_per_100g" placeholder="–ë–µ–ª–∫–∏ –Ω–∞ 100–≥ (–≥)" min="0">
            
            <input type="number" step="0.1" class="aero-input optional-field" id="fats-per-100g" 
                   name="fats_per_100g" placeholder="–ñ–∏—Ä—ã –Ω–∞ 100–≥ (–≥)" min="0">
            
            <input type="number" step="0.1" class="aero-input optional-field" id="carbs-per-100g" 
                   name="carbs_per_100g" placeholder="–£–≥–ª–µ–≤–æ–¥—ã –Ω–∞ 100–≥ (–≥)" min="0">
            
            <!-- –ü–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π -->
            <span class="nutrition-label">–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤–µ—Å–∞:</span>
            <input type="number" step="0.1" class="aero-input calculated-input" id="calories-display" 
                   placeholder="–ö–∞–ª–æ—Ä–∏–∏ (–∫–∫–∞–ª)" readonly>
            
            <input type="number" step="0.1" class="aero-input calculated-input" id="proteins-display" 
                   placeholder="–ë–µ–ª–∫–∏ (–≥)" readonly>
            
            <input type="number" step="0.1" class="aero-input calculated-input" id="fats-display" 
                   placeholder="–ñ–∏—Ä—ã (–≥)" readonly>
            
            <input type="number" step="0.1" class="aero-input calculated-input" id="carbs-display" 
                   placeholder="–£–≥–ª–µ–≤–æ–¥—ã (–≥)" readonly>
            
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π -->
            <input type="hidden" id="calories" name="calories" value="{{ meal.calories }}">
            <input type="hidden" id="proteins" name="proteins" value="{{ meal.proteins }}">
            <input type="hidden" id="fats" name="fats" value="{{ meal.fats }}">
            <input type="hidden" id="carbs" name="carbs" value="{{ meal.carbs }}">
            
            <div class="result-display" id="result-display">
                –î–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥: 0 –∫–∫–∞–ª | –ë: 0–≥ | –ñ: 0–≥ | –£: 0–≥
            </div>
            
            <button type="submit" class="aero-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
        
        <div class="form-footer">
            <a href="{{ url_for('index') }}" class="nav-item" style="color:white">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞
        function recalculateNutrition() {
            const grams = parseFloat(document.getElementById('grams').value) || 100;
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 100–≥
            const caloriesPer100g = parseFloat(document.getElementById('calories-per-100g').value) || 0;
            const proteinsPer100g = parseFloat(document.getElementById('proteins-per-100g').value) || 0;
            const fatsPer100g = parseFloat(document.getElementById('fats-per-100g').value) || 0;
            const carbsPer100g = parseFloat(document.getElementById('carbs-per-100g').value) || 0;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤–µ—Å–∞
            const ratio = grams / 100;
            const calculatedCalories = (caloriesPer100g * ratio).toFixed(1);
            const calculatedProteins = (proteinsPer100g * ratio).toFixed(1);
            const calculatedFats = (fatsPer100g * ratio).toFixed(1);
            const calculatedCarbs = (carbsPer100g * ratio).toFixed(1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            document.getElementById('calories-display').value = calculatedCalories;
            document.getElementById('proteins-display').value = calculatedProteins;
            document.getElementById('fats-display').value = calculatedFats;
            document.getElementById('carbs-display').value = calculatedCarbs;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('calories').value = calculatedCalories;
            document.getElementById('proteins').value = calculatedProteins;
            document.getElementById('fats').value = calculatedFats;
            document.getElementById('carbs').value = calculatedCarbs;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥
            document.getElementById('result-display').textContent = 
                `–î–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥: ${caloriesPer100g} –∫–∫–∞–ª | –ë: ${proteinsPer100g}–≥ | –ñ: ${fatsPer100g}–≥ | –£: ${carbsPer100g}–≥`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ 100–≥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏
        function recalculatePer100g() {
            const grams = parseFloat(document.getElementById('grams').value) || 100;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const calories = parseFloat(document.getElementById('calories-display').value) || 0;
            const proteins = parseFloat(document.getElementById('proteins-display').value) || 0;
            const fats = parseFloat(document.getElementById('fats-display').value) || 0;
            const carbs = parseFloat(document.getElementById('carbs-display').value) || 0;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 100–≥
            const ratio = 100 / grams;
            const caloriesPer100g = (calories * ratio).toFixed(1);
            const proteinsPer100g = (proteins * ratio).toFixed(1);
            const fatsPer100g = (fats * ratio).toFixed(1);
            const carbsPer100g = (carbs * ratio).toFixed(1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ 100–≥
            document.getElementById('calories-per-100g').value = caloriesPer100g;
            document.getElementById('proteins-per-100g').value = proteinsPer100g;
            document.getElementById('fats-per-100g').value = fatsPer100g;
            document.getElementById('carbs-per-100g').value = carbsPer100g;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥
            document.getElementById('result-display').textContent = 
                `–î–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥: ${caloriesPer100g} –∫–∫–∞–ª | –ë: ${proteinsPer100g}–≥ | –ñ: ${fatsPer100g}–≥ | –£: ${carbsPer100g}–≥`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –∫ 100–≥
        function resetTo100g() {
            document.getElementById('grams').value = 100;
            recalculateNutrition();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 100–≥
            const grams = parseFloat("{{ meal.grams }}") || 100;
            const ratio = 100 / grams;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ 100–≥
            document.getElementById('calories-per-100g').value = (parseFloat("{{ meal.calories }}") * ratio).toFixed(1);
            document.getElementById('proteins-per-100g').value = (parseFloat("{{ meal.proteins }}") * ratio).toFixed(1);
            document.getElementById('fats-per-100g').value = (parseFloat("{{ meal.fats }}") * ratio).toFixed(1);
            document.getElementById('carbs-per-100g').value = (parseFloat("{{ meal.carbs }}") * ratio).toFixed(1);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            document.getElementById('calories-display').value = parseFloat("{{ meal.calories }}").toFixed(1);
            document.getElementById('proteins-display').value = parseFloat("{{ meal.proteins }}").toFixed(1);
            document.getElementById('fats-display').value = parseFloat("{{ meal.fats }}").toFixed(1);
            document.getElementById('carbs-display').value = parseFloat("{{ meal.carbs }}").toFixed(1);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ 100–≥
            recalculatePer100g();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª—è –≤–µ—Å–∞
            document.getElementById('grams').addEventListener('input', recalculateNutrition);
            document.getElementById('grams').addEventListener('change', recalculateNutrition);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ 100–≥
            const per100gFields = [
                document.getElementById('calories-per-100g'),
                document.getElementById('proteins-per-100g'),
                document.getElementById('fats-per-100g'),
                document.getElementById('carbs-per-100g')
            ];
            
            per100gFields.forEach(field => {
                field.addEventListener('input', recalculateNutrition);
                field.addEventListener('change', recalculateNutrition);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('meal-form').addEventListener('submit', function(e) {
                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–µ—Ä–µ—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                recalculateNutrition();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                const nameField = document.querySelector('input[name="name"]');
                const gramsField = document.getElementById('grams');
                
                if (!nameField.value.trim()) {
                    e.preventDefault();
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞');
                    nameField.focus();
                    return;
                }
                
                if (!gramsField.value || parseFloat(gramsField.value) <= 0) {
                    e.preventDefault();
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (–±–æ–ª—å—à–µ 0)');
                    gramsField.focus();
                    return;
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            recalculateNutrition();
        });
    </script>
</body>
</html>